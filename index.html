<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Matcher.AI Â· (AI Ver.) ì»¬ëŸ¬ ë§¤ì¹­ (ë¬´ë“œÂ·ìŠ¤íƒ€ì¼)</title>
<style>
  :root{
    --bg:#0f1115; --card:#151924; --text:#e8ecf1; --muted:#93a0ba; --border:#212635;
    --chip:#1e2330; --ok:#66d19e; --safe:#9db2ff; --pro:#ffcf6e; --accent:#8abdff;
  }
  *{box-sizing:border-box}
  body{margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  a{color:var(--accent)}
  .wrap{max-width:1100px; margin:24px auto; padding:16px}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .title{font-weight:800; font-size:22px; margin-bottom:12px; display:flex; align-items:center; justify-content:space-between}
  .panel,.section{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:12px}
  .btn{border:1px solid var(--border); background:#0e1119; color:#e8ecf1; padding:8px 10px; border-radius:10px; cursor:pointer; transition:background .2s}
  .btn:hover{background:var(--border)}
  .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:10px}
  .card{background:#0e1119; border:1px solid var(--border); border-radius:12px; padding:12px; position:relative; cursor:pointer}
  .swatch{width:18px; height:18px; border-radius:4px; border:1px solid #0006; display:inline-block}
  .name{font-weight:700; margin-left:8px}
  .star{position:absolute; right:10px; top:10px; font-size:16px; opacity:.9; cursor:pointer}
  .star.fav{color:#ffd76b; text-shadow:0 0 8px #0006}
  .tag{font-weight:800; font-size:14px}
  .chips{display:flex; flex-wrap:wrap; gap:8px}
  .chip{display:inline-flex; align-items:center; gap:8px; background:var(--chip); border:1px solid var(--border); padding:8px 10px; border-radius:999px; cursor:pointer; transition:background .2s}
  .chip:hover{background:var(--border)}
  .muted{color:var(--muted); font-size:13px}
  .sec-head{display:flex; justify-content:space-between; align-items:center; margin-bottom:6px}
  .ok{color:var(--ok)} .safe{color:var(--safe)} .pro{color:var(--pro)}
  details.section{padding:0}
  summary{list-style:none; cursor:pointer; padding:12px; border-radius:14px; display:flex; align-items:center; justify-content:space-between}
  summary::-webkit-details-marker{display:none}
  .sum-left{display:flex; align-items:center; gap:8px}
  .chev{transition:transform .15s ease; opacity:.9}
  details[open] .chev{transform:rotate(90deg)}

  /* layout */
  .cols{display:grid; grid-template-columns: 320px 1fr; gap:12px}
  @media (max-width: 900px){ .cols{grid-template-columns:1fr} }

  /* preview */
  .preview-wrap{display:flex; gap:10px; margin-bottom:12px; align-items:stretch}
  .preview{flex:1; min-width:100px; background:var(--bg); border:1px solid var(--border); border-radius:10px; display:flex; flex-direction:column; padding:4px}
  .preview-top, .preview-bottom{flex:1; border-radius:6px; transition:background-color .3s ease}
  .preview-top{background:#444; margin-bottom:3px}
  .preview-bottom{background:#555}
  .preview-info{flex:2; display:flex; flex-direction:column; justify-content:center}
  .preview-label{font-size:13px; color:var(--muted); margin-bottom:4px}
  .preview-color-name{font-size:16px; font-weight:700}
  .small{font-size:12px}
  .mode-toggle .chip.active{outline:2px solid var(--accent)}

  /* --- AI ì…ë ¥ --- */
  #textPrompt{
    width:100%; background:var(--bg); border:1px solid var(--border); color:var(--text);
    padding:10px; border-radius:10px; margin-top:4px;
  }
  #aiBtn{
    width:100%; background:var(--accent); color:var(--bg); font-weight:700;
    font-size:15px; padding:10px; margin-top:8px; border-color:var(--accent);
  }
  #aiBtn:hover{background:#a2c4ff}
  
  /* --- AI ì¶”ì²œ ê²°ê³¼ --- */
  .chip-reco{
    width:100%; padding:10px 12px; border-radius:10px; align-items:flex-start;
    flex-direction:column; gap:6px; cursor:pointer;
  }
  .chip-reco .row{ flex-wrap:nowrap; }
  .chip-reco .reasoning{
    font-size:13px; color:var(--muted); margin:0; padding-left:26px;
    line-height:1.5; white-space:normal;
  }

  /* --- ë¡œë”© ì˜¤ë²„ë ˆì´ --- */
  #loadingOverlay{
    position:fixed; inset:0; background:#00000099; backdrop-filter:blur(4px);
    display:none; align-items:center; justify-content:center; z-index:999;
  }
  #loadingOverlay::after{
    content:''; display:block; width:40px; height:40px;
    border:4px solid var(--border); border-top-color:var(--accent);
    border-radius:50%; animation:spin 1s linear infinite;
  }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

</style>
</head>
<body>
<div id="loadingOverlay"></div>

<div class="wrap">
  <div class="title">
    <div>Matcher.AI Â· (AI Ver.) ì»¬ëŸ¬ ë§¤ì¹­ (ë¬´ë“œÂ·ìŠ¤íƒ€ì¼)</div>
    <div class="row">
      <button class="btn" id="uxBtn" aria-label="UX ê°€ì´ë“œ">UX ê°€ì´ë“œ</button>
      <button class="btn" id="resetBtn" aria-label="ì´ˆê¸°í™”">ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="cols">
    <div class="panel">
      <div class="sec-head"><div class="tag">1) ë¶„ìœ„ê¸°(ë¬´ë“œ)</div><div id="moodHint" class="muted">-</div></div>
      <div id="moodChips" class="chips"></div>
      <div class="sec-head" style="margin-top:10px"><div class="tag">2) íŒ¨ì…˜ ìŠ¤íƒ€ì¼</div><div id="styleHint" class="muted">-</div></div>
      <div id="styleChips" class="chips"></div>
      <div class="sec-head" style="margin-top:10px"><div class="tag">3) ì¶”ì²œ ëª¨ë“œ</div><div class="muted">ì–‘ë°©í–¥</div></div>
      <div class="chips mode-toggle" id="modeChips"></div>
      
      <div class="sec-head" style="margin-top:10px"><div class="tag">4) AIì— ì§ì ‘ ìš”ì²­</div></div>
      <input id="textPrompt" type="text" placeholder="ì˜ˆ: ë©´ì ‘ìš©, ë°ì´íŠ¸ë£©, ì²­ë°”ì§€ ì½”ë””" />
      <button id="aiBtn" class="btn">AI ì¶”ì²œ ë°›ê¸°</button>
      
      <p class="muted small" style="margin-top:12px">ğŸ’¡ ìœ„ íƒœê·¸/ëª¨ë“œ/í…ìŠ¤íŠ¸ë¥¼ ì¡°í•©í•˜ì—¬ AIê°€ ì¶”ì²œì„ ìƒì„±í•©ë‹ˆë‹¤. ìƒ‰ìƒ ì¹´ë“œë¥¼ í´ë¦­í•´ë„ AI ì¶”ì²œì´ ë™ì‘í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="section">
      <details id="paletteSection" class="section" open>
        <summary>
          <div class="sum-left"><span class="chev">â–¶</span><span class="tag" id="paletteTitle">ëª¨ë“  ìƒì˜ ìƒ‰</span></div>
          <div id="allCount" class="muted">0ê°œ</div>
        </summary>
        <div style="padding:12px;">
          <div class="sec-head" style="margin-top:2px;"><div class="tag">í•µì‹¬ 5</div></div>
          <div id="coreGrid" class="grid" style="margin-bottom:8px;"></div>
          <details id="moreColors" class="section" style="margin-top:8px;">
            <summary>
              <div class="sum-left"><span class="chev">â–¶</span><span class="tag">ë”ë³´ê¸°</span></div>
              <div id="moreCount" class="muted">0ê°œ</div>
            </summary>
            <div style="padding:12px 12px 0 12px;"><div id="restGrid" class="grid"></div></div>
          </details>
        </div>
      </details>

      <div id="resultSection" class="section" style="margin-top:12px;">
        <div class="sec-head"><div class="tag" id="resultTitle">ì¶”ì²œ í•˜ì˜</div><div id="recentHint" class="muted">ìµœê·¼ ì„ íƒ: -</div></div>
        <div id="resultArea"><p style="color:#93a0ba">ğŸ’¡ ìƒ‰ ì¹´ë“œë¥¼ í´ë¦­í•˜ê±°ë‚˜ AIì— ìš”ì²­í•˜ë©´ ì¶”ì²œì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p></div>
      </div>
    </div>
  </div>
</div>

<div id="uxModal" style="display:none; position:fixed; inset:0; background:#0008; backdrop-filter: blur(2px); align-items:center; justify-content:center;">
  <div style="width:min(760px,90vw); max-height:80vh; overflow:auto" class="panel">
    <div class="sec-head"><div class="tag">UX ê°€ì´ë“œ (AI Ver.)</div><button class="btn" id="uxClose">ë‹«ê¸°</button></div>
    <ol style="margin:0 0 6px 18px; line-height:1.6">
      <li><b>ë¬´ë“œ</b>ì™€ <b>ìŠ¤íƒ€ì¼</b>ì„ ë¨¼ì € ì„ íƒí•©ë‹ˆë‹¤.</li>
      <li>AIì—ê²Œ êµ¬ì²´ì ì¸ ìƒí™©(<b>í…ìŠ¤íŠ¸</b>)ì„ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆ: "ë°ì´íŠ¸ë£©", "ì²­ë°”ì§€ ì½”ë””")</li>
      <li><b>ëª¨ë“œ</b>(ìƒì˜â†’í•˜ì˜, í•˜ì˜â†’ìƒì˜)ë¥¼ ì •í•©ë‹ˆë‹¤. (í…ìŠ¤íŠ¸ ì…ë ¥ ì‹œì—ë„ ëª¨ë“œê°€ ì ìš©ë¨)</li>
      <li><b>ìƒ‰ìƒ ì¹´ë“œë¥¼ í´ë¦­</b>í•˜ê±°ë‚˜, <b>"AI ì¶”ì²œ ë°›ê¸°" ë²„íŠ¼</b>ì„ ëˆ„ë¦…ë‹ˆë‹¤.</li>
      <li>"ë°ì´íŠ¸ë£©" ê°™ì€ ìƒí™© ìš”ì²­ ì‹œ, AIê°€ ìƒ/í•˜ì˜ **ì¡°í•©**ì„ ì¶”ì²œí•©ë‹ˆë‹¤.</li>
      <li>ì¶”ì²œ ì¹©ì„ í´ë¦­í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ì— ë°˜ì˜ë˜ë©°, ë¬´ì‹ ì‚¬ ë§í¬ë„ í•¨ê»˜ ì œê³µë©ë‹ˆë‹¤.</li>
    </ol>
    <p class="muted small">â€» ë³¸ ë²„ì „ì€ ì‹¤ì œ AI APIë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³ , <b>AI ì‘ë‹µì„ ì‹œë®¬ë ˆì´ì…˜(Mock)</b>í•©ë‹ˆë‹¤.</p>
  </div>
</div>

<script>
/* ===== ê¸°ë³¸ ë°ì´í„° (ìƒ‰ìƒ) ===== */
const COLOR_HEX = {"ë²„ê±´ë””":"#7A1F2B","ë„¤ì´ë¹„":"#0E2C54","ë¯¸ë“œ ê·¸ë ˆì´":"#8B8F98","í¬ë ˆìŠ¤íŠ¸ ê·¸ë¦°":"#2F5D50","í™”ì´íŠ¸":"#FFFFFF","ì•„ì´ë³´ë¦¬":"#F5F0E6","í¬ë¦¼":"#FAF3E5","ë² ì´ì§€":"#D9C7A1","ì°¨ì½œ":"#2B2F39","ë¸”ë™":"#000000","ë¸Œë¼ìš´":"#6E4C3A","ëª¨ì¹´":"#7B5B48","ì¹´í‚¤(ì˜¬ë¦¬ë¸Œ)":"#6C7A3C","ì˜¬ë¦¬ë¸Œ":"#6C7A3C","ê·¸ë¦°":"#2A8A4B","ì„¸ì´ì§€ ê·¸ë¦°":"#8AA391","ë¼ì´íŠ¸ ê·¸ë ˆì´":"#D7DBE0","ê·¸ë ˆì´":"#8B8F98","ìŠ¬ë ˆì´íŠ¸ ë¸”ë£¨":"#5B6E8A","ì¤‘ì²­ ë°ë‹˜":"#274D7E","í‘ì²­":"#31343C","ë¼ì¼ë½":"#B79BCF","í¼í”Œ":"#6441A5","í•‘í¬":"#E7A8B3","ì½”ë„":"#FF7F6E","í…Œë¼ì½”íƒ€":"#C25A3A","ë ˆë“œ":"#E53935","ì˜¤ë Œì§€":"#F78C2F","ì˜ë¡œìš°":"#FACF37","ë²„í„° ì˜ë¡œ":"#F2E29D","ì†Œë¼ìƒ‰":"#9EC5E8","ë¼ì´íŠ¸ ë¸”ë£¨":"#AFC9F6","ë¯¼íŠ¸":"#AEE4D4","í‹¸(ì²­ë¡)":"#1C8073","ê·¸ë ˆì´ì§€":"#BDB6A6","ë”¥ë¸”ë£¨":"#0B3A7E","ì—°ë‘ìƒ‰":"#9ED36A"};

/* ===== ë¬´ë“œ/ìŠ¤íƒ€ì¼ íŒíŠ¸ ì„¸íŠ¸ (AIì— ì»¨í…ìŠ¤íŠ¸ë¡œ ì œê³µ) ===== */
const MOODS = [
  {id:'warm', label:'ë”°ëœ»í•œ', colors:[]}, 
  {id:'cool', label:'ì°¨ê°€ìš´', colors:[]},
  {id:'neutral', label:'ì¤‘ë¦½', colors:[]}
];
const STYLES = [
  {id:'casual', label:'ìºì£¼ì–¼', colors:[]},
  {id:'street', label:'ìŠ¤íŠ¸ë¦¿', colors:[]},
  {id:'dandy', label:'ëŒ„ë””', colors:[]},
  {id:'retro', label:'ë ˆíŠ¸ë¡œ', colors:[]}
];

/* ===== ìƒíƒœ ì €ì¥/ìœ í‹¸ ===== */
const LS = { fav:"favColors.v2", recent:"recentColor.v2", mode:"mode.v1", mood:"mood.v1", style:"style.v1" };
const $ = s=>document.querySelector(s);
function gLS(k,f){ try{const v=localStorage.getItem(k); return v?JSON.parse(v):f;}catch{return f;}}
function sLS(k,v){ try{localStorage.setItem(k,JSON.stringify(v));}catch{} }

/* ì´ë¦„/ë¦¬ìŠ¤íŠ¸ (íŒ”ë ˆíŠ¸ í‘œì‹œì—ë§Œ ì‚¬ìš©) */
const NAMES = Object.keys(COLOR_HEX).sort((a,b)=>a.localeCompare(b,'ko'));
const CORE = ["ë¸”ë™","ì°¨ì½œ","ë²„ê±´ë””","ì˜¬ë¦¬ë¸Œ","í™”ì´íŠ¸"];
const REST = NAMES.filter(n=>!CORE.includes(n));

function favSet(){ return new Set(gLS(LS.fav, [])); }
function isFav(n){ return favSet().has(n); }
function toggleFav(n){ const s=favSet(); s.has(n)?s.delete(n):s.add(n); sLS(LS.fav,[...s]); renderPalette(); }

/* ===== ì‹ ê·œ: AI ì¶”ì²œ ë¡œì§ (ì‹œë®¬ë ˆì´ì…˜) ===== */

function showLoading(show) {
  $('#loadingOverlay').style.display = show ? 'flex' : 'none';
}

/**
 * AI API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜ (ìˆ˜ì •ë¨)
 */
function mockAIApiCall(request) {
  console.log("AI Request:", request);
  const { top, bottom, text, mood, style } = request;

  // 1. (ì‹ ê·œ) í…ìŠ¤íŠ¸ ì „ìš© ìƒí™©ë³„ ìš”ì²­ (ë°ì´íŠ¸ë£©, ë©´ì ‘ë£© ë“±)
  // (request.top, request.bottomì´ ë¹„ì–´ìˆê³  textë§Œ ì¡´ì¬í•  ë•Œ)
  if (text && !top && !bottom) {
    if (text.includes("ë°ì´íŠ¸ë£©")) {
      return {
        // AIê°€ ìƒ/í•˜ì˜ í˜ì–´ë¥¼ ì œì•ˆ
        _suggestedTop: 'í•‘í¬', // ë¯¸ë¦¬ë³´ê¸°ìš© ìƒì˜ ì œì•ˆ
        _suggestedBottom: 'ì•„ì´ë³´ë¦¬', // ë¯¸ë¦¬ë³´ê¸°ìš© í•˜ì˜ ì œì•ˆ
        
        // ì‚¬ìš©ìëŠ” ë‹¤ë¥¸ 'í•˜ì˜' ì˜µì…˜ì„ ë³¼ ìˆ˜ ìˆìŒ (ëª¨ë“œê°€ ìƒì˜->í•˜ì˜ ì˜€ë‹¤ë©´)
        // (ì´ ë¡œì§ì€ ëª¨ë“œê°€ í•˜ì˜->ìƒì˜ ì˜€ë‹¤ë©´ ìƒì˜ ì˜µì…˜ì„ ë°˜í™˜í•´ì•¼ í•˜ë‚˜, ë°ëª¨ìƒ ë‹¨ìˆœí™”)
        perfect: [ 
          { name: 'ì•„ì´ë³´ë¦¬', reasoning: 'AI ì¶”ì²œ: í•‘í¬ ìƒì˜ì™€ ë§¤ì¹˜í•˜ì—¬ ë¡œë§¨í‹±í•œ ë¬´ë“œë¥¼ ì™„ì„±í•©ë‹ˆë‹¤.' }, 
          { name: 'í™”ì´íŠ¸', reasoning: 'ì–´ë–¤ íŒŒìŠ¤í…”í†¤ ìƒì˜ì™€ë„ ì–´ìš¸ë¦¬ëŠ” ê¹”ë”í•œ ì„ íƒì…ë‹ˆë‹¤.' } 
        ],
        safe: [ 
          { name: 'ì¤‘ì²­ ë°ë‹˜', reasoning: 'ìºì£¼ì–¼ ë°ì´íŠ¸ì— ì–´ìš¸ë¦¬ëŠ” í¸ì•ˆí•œ ì¡°í•©ì…ë‹ˆë‹¤.' }, 
          { name: 'ë² ì´ì§€', reasoning: 'ë¶€ë“œëŸ¬ìš´ í†¤ì˜¨í†¤ ë£©ì„ ì—°ì¶œí•©ë‹ˆë‹¤.' } 
        ],
        pro: [ 
          { name: 'ë¼ì´íŠ¸ ë¸”ë£¨', reasoning: 'í™”ì‚¬í•¨ì„ ë”í•  ìˆ˜ ìˆëŠ” ì¡°í•©ì…ë‹ˆë‹¤.' } 
        ]
      };
    }
    // (ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì „ìš© ì‹œë‚˜ë¦¬ì˜¤... ì˜ˆ: "ë©´ì ‘")
  }

  // 2. ìƒ‰ìƒ ê¸°ë°˜ ìš”ì²­ (ë²„ê±´ë”” ìƒì˜ ì˜ˆì‹œ)
  if (top === 'ë²„ê±´ë””') {
    let reasoning_ivory = 'ë²„ê±´ë””ì˜ ê¹Šì€ ìƒ‰ê°ê³¼ ì•„ì´ë³´ë¦¬ì˜ ë¶€ë“œëŸ¬ì›€ì´ ë§Œë‚˜ í´ë˜ì‹í•˜ê³  ë”°ëœ»í•œ ë£©ì„ ì™„ì„±í•©ë‹ˆë‹¤.';
    if (mood === 'warm') reasoning_ivory += ' (ë”°ëœ»í•œ ë¬´ë“œ ê°€ì‚°ì )';
    if (style === 'dandy') reasoning_ivory += ' (ëŒ„ë”” ìŠ¤íƒ€ì¼ ê°€ì‚°ì )';
    
    return {
      perfect: [ { name: 'ì•„ì´ë³´ë¦¬', reasoning: reasoning_ivory }, { name: 'ë„¤ì´ë¹„', reasoning: 'ì–´ë‘ìš´ ê³„ì—´ì˜ ì¡°í•©ìœ¼ë¡œ ì•ˆì •ê°ê³¼ ì‹ ë¢°ê°ì„ ì¤ë‹ˆë‹¤.' } ],
      safe: [ { name: 'ë¸”ë™', reasoning: 'ê°€ì¥ ì•ˆì „í•œ ì¡°í•©ì´ì§€ë§Œ, ë„ˆë¬´ ì–´ë‘ì›Œ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.' }, { name: 'ë¼ì´íŠ¸ ê·¸ë ˆì´', reasoning: 'ë²„ê±´ë””ë¥¼ ë‹ë³´ì´ê²Œ í•˜ëŠ” ì¢‹ì€ ë°°ê²½ìƒ‰ì…ë‹ˆë‹¤.' } ],
      pro: [ { name: 'ì¹´í‚¤(ì˜¬ë¦¬ë¸Œ)', reasoning: 'í”í•˜ì§€ ì•Šì€ ì¡°í•©ìœ¼ë¡œ ê°œì„±ì„ ë“œëŸ¬ëƒ…ë‹ˆë‹¤.' }, { name: 'ë² ì´ì§€', reasoning: 'ì•„ì´ë³´ë¦¬ë³´ë‹¤ í•œ í†¤ ë‹¤ìš´ëœ ì°¨ë¶„í•¨ì„ ì—°ì¶œí•©ë‹ˆë‹¤.' } ]
    };
  }
  
  // 3. (í•˜ì˜ -> ìƒì˜) ì˜ˆì‹œ: ë„¤ì´ë¹„ í•˜ì˜
  if (bottom === 'ë„¤ì´ë¹„') {
     return {
      perfect: [ { name: 'í™”ì´íŠ¸', reasoning: 'ë„¤ì´ë¹„ì™€ í™”ì´íŠ¸ëŠ” ì‹¤íŒ¨ ì—†ëŠ” ë§ˆë¦°ë£©/ëŒ„ë””ë£© ì¡°í•©ì…ë‹ˆë‹¤.' }, { name: 'ì•„ì´ë³´ë¦¬', reasoning: 'í™”ì´íŠ¸ë³´ë‹¤ ë¶€ë“œëŸ½ê³  ë”°ëœ»í•œ ëŠë‚Œì„ ì¤ë‹ˆë‹¤.' }, ],
      safe: [ { name: 'ë¼ì´íŠ¸ ê·¸ë ˆì´', reasoning: 'ë„ì‹œì ì´ê³  ì„¸ë ¨ëœ ì´ë¯¸ì§€ë¥¼ ì—°ì¶œí•©ë‹ˆë‹¤.' }, { name: 'ë„¤ì´ë¹„', reasoning: 'í†¤ì˜¨í†¤ ë§¤ì¹˜ë¡œ ì•ˆì •ê°ì„ ì¤ë‹ˆë‹¤.' } ],
      pro: [ { name: 'ì˜ë¡œìš°', reasoning: 'ë„¤ì´ë¹„ì˜ íŒŒë€ìƒ‰ê³¼ ë³´ìƒ‰ ëŒ€ë¹„ë¥¼ ì´ë£¨ì–´ í™œê¸°ì°¬ ëŠë‚Œì„ ì¤ë‹ˆë‹¤.' }, { name: 'ë²„ê±´ë””', reasoning: 'ì‹ ë¢°ê°ê³¼ ê°œì„±ì„ ë™ì‹œì— ì¡ëŠ” ì¡°í•©ì…ë‹ˆë‹¤.' } ]
    };
  }

  // 4. 'ì²­ë°”ì§€'ê°€ 'ì¤‘ì²­ ë°ë‹˜'ìœ¼ë¡œ ë§¤í•‘ë˜ì–´ ìš”ì²­ëœ ê²½ìš°
  if (bottom === 'ì¤‘ì²­ ë°ë‹˜') {
     return {
      perfect: [ { name: 'í™”ì´íŠ¸', reasoning: `'${text || 'ì²­ë°”ì§€'}'(ì™€)ê³¼ í™”ì´íŠ¸ëŠ” í´ë˜ì‹í•œ ì¡°í•©ì…ë‹ˆë‹¤.` }, { name: 'ì•„ì´ë³´ë¦¬', reasoning: 'ë¶€ë“œëŸ¬ìš´ ìºì£¼ì–¼ ë¬´ë“œë¥¼ ì—°ì¶œí•©ë‹ˆë‹¤.' } ],
      safe: [ { name: 'ë¼ì´íŠ¸ ê·¸ë ˆì´', reasoning: 'í†¤ì˜¨í†¤ìœ¼ë¡œ ë¬´ë‚œí•˜ê²Œ ì–´ìš¸ë¦½ë‹ˆë‹¤.' }, { name: 'ë¸”ë™', reasoning: 'ì‹œí¬í•œ ìŠ¤íŠ¸ë¦¿ ë¬´ë“œë¥¼ ì—°ì¶œí•©ë‹ˆë‹¤.' } ],
      pro: [ { name: 'ë²„ê±´ë””', reasoning: 'ë°ë‹˜ì˜ íŒŒë€ìƒ‰ê³¼ ëŒ€ë¹„ë˜ì–´ ê°œì„±ì„ í‘œí˜„í•©ë‹ˆë‹¤.' } ]
    };
  }

  // 5. ê·¸ ì™¸ (ê¸°ë³¸ Mock ì‘ë‹µ)
  return {
    perfect: [
      { name: 'ì•„ì´ë³´ë¦¬', reasoning: `'${top || bottom}' í•­ëª©ì— ì•„ì´ë³´ë¦¬ê°€ ì™„ë²½í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.` },
      { name: 'ë„¤ì´ë¹„', reasoning: `'${top || bottom}' í•­ëª©ì— ë„¤ì´ë¹„ê°€ ì™„ë²½í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.` }
    ],
    safe: [ { name: 'ë¼ì´íŠ¸ ê·¸ë ˆì´', reasoning: 'ê°€ì¥ ë¬´ë‚œí•œ ì„ íƒì…ë‹ˆë‹¤.' }, { name: 'ë¸”ë™', reasoning: 'ê°€ì¥ ì•ˆì „í•œ ì„ íƒì…ë‹ˆë‹¤.' } ],
    pro: [ { name: 'ì¹´í‚¤(ì˜¬ë¦¬ë¸Œ)', reasoning: 'ê°œì„±ì„ í‘œí˜„í•˜ê¸° ì¢‹ì€ ìƒ‰ìƒì…ë‹ˆë‹¤.' } ]
  };
}


/**
 * AI ì¶”ì²œì„ ìš”ì²­í•˜ê³  ê²°ê³¼ë¥¼ í‘œì‹œí•˜ëŠ” ë©”ì¸ í•¨ìˆ˜
 */
async function getAndRenderAIRecommendation(request) {
  showLoading(true);
  try {
    await new Promise(resolve => setTimeout(resolve, 1500)); 
    const aiResponse = mockAIApiCall(request);
    
    // ê²°ê³¼ ë Œë”ë§
    renderAIResult(request, aiResponse);
  } catch (err) {
    console.error("AI ì¶”ì²œ ì‹¤íŒ¨:", err);
    $('#resultArea').innerHTML = `<p style="color:var(--pro)">AI ì¶”ì²œì„ ë°›ì•„ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>`;
  } finally {
    showLoading(false);
  }
}


/* ===== UI ë¹Œë”© (ê¸°ì¡´ê³¼ ë™ì¼) ===== */
function chip(label, id, group){
  const el = document.createElement('div');
  el.className = 'chip'; el.dataset.id = id; el.dataset.group = group; el.textContent = label;
  return el;
}

function buildChips(){
  const moodWrap = $('#moodChips'); moodWrap.innerHTML='';
  MOODS.forEach(m=> moodWrap.appendChild(chip(m.label, m.id, 'mood')));
  const styleWrap = $('#styleChips'); styleWrap.innerHTML='';
  STYLES.forEach(s=> styleWrap.appendChild(chip(s.label, s.id, 'style')));
  const modeWrap = $('#modeChips'); modeWrap.innerHTML='';
  [
    {id:'top2bottom', label:'ìƒì˜ â†’ í•˜ì˜'},
    {id:'bottom2top', label:'í•˜ì˜ â†’ ìƒì˜'}
  ].forEach(m=> modeWrap.appendChild(chip(m.label, m.id, 'mode')));

  const savedMood = gLS(LS.mood, 'neutral'); activateChip('mood', savedMood);
  const savedStyle = gLS(LS.style, null); if(savedStyle) activateChip('style', savedStyle);
  const savedMode = gLS(LS.mode, 'top2bottom'); activateChip('mode', savedMode);
  updateHints();
}

function activateChip(group, id){
  document.querySelectorAll(`.chip[data-group="${group}"]`).forEach(c=>{
    const active = c.dataset.id===id;
    c.classList.toggle('active', active);
    c.style.outline = active? '2px solid var(--accent)' : '';
  });
  if(group==='mood') sLS(LS.mood, id);
  if(group==='style') sLS(LS.style, id);
  if(group==='mode') sLS(LS.mode, id), updateModeTitles();
}

function current(group){
  const act = document.querySelector(`.chip[data-group="${group}"].active`);
  return act? act.dataset.id : (group==='mood'?'neutral':null);
}

function updateHints(){
  const m = current('mood'); const s = current('style');
  $('#moodHint').textContent = m? MOODS.find(x=>x.id===m).label : '-';
  $('#styleHint').textContent = s? STYLES.find(x=>x.id===s).label : '-';
}

/* íŒ”ë ˆíŠ¸ ì¹´ë“œ (ê¸°ì¡´ê³¼ ë™ì¼) */
function makeCard(name){
  const card = document.createElement('div');
  card.className = 'card'; card.dataset.name = name;
  card.innerHTML = `
    <span class="star ${isFav(name)?'fav':''}">${isFav(name)?'â˜…':'â˜†'}</span>
    <div class="row">
      <span class="swatch" style="background:${COLOR_HEX[name]||'#9aa3b2'}" title="${name}"></span>
      <span class="name">${name}</span>
    </div>`;
  card.querySelector('.star').addEventListener('click', (e) => { e.stopPropagation(); toggleFav(name); });
  card.addEventListener('click', () => onColorCardClick(name)); 
  return card;
}

function renderPalette(){
  const coreGrid = $('#coreGrid'); coreGrid.innerHTML = ''; CORE.forEach(n => coreGrid.appendChild(makeCard(n)));
  const restGrid = $('#restGrid'); restGrid.innerHTML = ''; REST.forEach(n => restGrid.appendChild(makeCard(n)));
  $('#moreCount').textContent = `${REST.length}ê°œ`; $('#allCount').textContent = `ì´ ${NAMES.length}ê°œ`;
}

function updateModeTitles(){
  const mode = current('mode')||'top2bottom';
  if(mode==='top2bottom'){
    $('#paletteTitle').textContent = 'ëª¨ë“  ìƒì˜ ìƒ‰';
    $('#resultTitle').textContent = 'ì¶”ì²œ í•˜ì˜';
  } else {
    $('#paletteTitle').textContent = 'ëª¨ë“  í•˜ì˜ ìƒ‰';
    $('#resultTitle').textContent = 'ì¶”ì²œ ìƒì˜';
  }
}

/* ë§í¬ (ê¸°ì¡´ê³¼ ë™ì¼) */
function q(s){ return encodeURIComponent(String(s||'').replace(/\s+/g,' ').trim()); }
function updateMusinsaLink(which, colorName){
  const wrap = document.getElementById(which==='top' ? 'musinsaTopWrap' : 'musinsaBottomWrap');
  const el = document.getElementById(which==='top' ? 'musinsaTopLink' : 'musinsaBottomLink');
  if(!wrap||!el) return;
  if(!colorName){ wrap.style.display='none'; return; }
  wrap.style.display='block';
  const query = which==='top' ? `${colorName} ìƒì˜` : `${colorName} ë°”ì§€`;
  const url = `https://www.musinsa.com/search/musinsa?q=${q(query)}`;
  el.textContent = `â€˜${colorName}â€™ ìƒ‰ ${which==='top'?'ìƒì˜':'í•˜ì˜'} ê²€ìƒ‰í•˜ê¸°`;
  el.href = url;
}

/* ===== ìˆ˜ì •: AI ê²°ê³¼ ë Œë”ë§ ===== */

/**
 * AI ì¶”ì²œ ì¹© (í•˜ë‚˜)ì„ ë§Œë“­ë‹ˆë‹¤.
 */
function createRecoChip(item) {
  return `
    <div class="chip chip-reco" data-color="${item.name}">
      <div class="row">
        <span class="swatch" style="background:${COLOR_HEX[item.name]||'#9aa3b2'}"></span>
        <span class="name">${item.name}</span>
      </div>
      <p class="reasoning">${item.reasoning}</p>
    </div>`;
}

/**
 * AI ì¶”ì²œ ê·¸ë£¹ (ì°°ë–¡/ë¬´ë‚œ/ê³ ìˆ˜) ì„¹ì…˜ì„ ë§Œë“­ë‹ˆë‹¤.
 */
function createSectionWithAI(label, cls, items) {
  if (!items || !items.length) return '';
  return `
    <div class="panel">
      <div class="sec-head"><div class="tag ${cls}">${label}</div><div class="muted">${items.length}ê°œ</div></div>
      <div class="chips" style="flex-direction:column;">
        ${items.map(createRecoChip).join('')}
      </div>
    </div>`;
}

/**
 * AI ì‘ë‹µì„ ë°›ì•„ì™€ ì „ì²´ ê²°ê³¼ ì˜ì—­ì„ ê·¸ë¦½ë‹ˆë‹¤. (ìˆ˜ì •ë¨)
 */
function renderAIResult(request, aiResponse) {
  const { top: reqTop, bottom: reqBottom, text } = request;
  // (ìˆ˜ì •) AIê°€ ì œì•ˆí•œ ìƒ/í•˜ì˜ ì¡°í•©ì„ ë°›ìŒ
  const { perfect, safe, pro, _suggestedTop, _suggestedBottom } = aiResponse; 
  
  const allItems = [...(perfect||[]), ...(safe||[]), ...(pro||[])];
  const firstReco = allItems[0]?.name; // ì¶”ì²œ ëª©ë¡ì˜ ì²«ë²ˆì§¸ (ì˜ˆ: ì•„ì´ë³´ë¦¬)

  let topName, bottomName;

  // (í•µì‹¬ ìˆ˜ì •) AIê°€ í˜ì–´ë¥¼ ì œì•ˆí•œ ê²½ìš° (ì˜ˆ: 'ë°ì´íŠ¸ë£©')
  if (_suggestedTop && _suggestedBottom) {
    topName = _suggestedTop;
    bottomName = _suggestedBottom;
  } 
  // (ê¸°ì¡´) ìƒ‰ìƒ ê¸°ë°˜ ìš”ì²­
  else if (reqTop) { // ìƒì˜ -> í•˜ì˜
    topName = reqTop;
    bottomName = firstReco || 'ì¶”ì²œ ì—†ìŒ';
  } else if (reqBottom) { // í•˜ì˜ -> ìƒì˜
    topName = firstReco || 'ì¶”ì²œ ì—†ìŒ';
    bottomName = reqBottom;
  }

  // í—¥ìŠ¤ ì½”ë“œ ì°¾ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
  const topHex = COLOR_HEX[topName] || '#444';
  const bottomHex = COLOR_HEX[bottomName] || '#555';

  const area = $('#resultArea');
  area.innerHTML = `
    <div class="preview-wrap">
      <div class="preview">
        <div id="previewTop" class="preview-top" style="background:${topHex}"></div>
        <div id="previewBottom" class="preview-bottom" style="background:${bottomHex}"></div>
      </div>
      <div class="preview-info">
        <div class="preview-label">ìƒì˜</div>
        <div id="topColorName" class="preview-color-name">${topName}</div>
        <div class="preview-label" style="margin-top:8px;">í•˜ì˜</div>
        <div id="bottomColorName" class="preview-color-name">${bottomName}</div>
      </div>
    </div>
    <div id="recoGrid" class="grid"></div>

    <div class="panel" id="musinsaTopWrap" style="margin-top:12px; display:none;">
      <div class="sec-head"><div class="tag">ë¬´ì‹ ì‚¬ ë§í¬</div><div class="muted">ìƒì˜</div></div>
      <p style="margin:2px 0 0 0; padding:0 6px 6px 6px;">
        <a id="musinsaTopLink" href="#" target="_blank" rel="noopener" style="text-decoration:underline;">-</a>
      </p>
    </div>

    <div class="panel" id="musinsaBottomWrap" style="margin-top:8px; display:none;">
      <div class="sec-head"><div class="tag">ë¬´ì‹ ì‚¬ ë§í¬</div><div class="muted">í•˜ì˜</div></div>
      <p style="margin:2px 0 0 0; padding:0 6px 6px 6px;">
        <a id="musinsaBottomLink" href="#" target="_blank" rel="noopener" style="text-decoration:underline;">-</a>
      </p>
    </div>`;

  const grid = $('#recoGrid');
  grid.innerHTML =
    createSectionWithAI('ì°°ë–¡', 'ok', perfect) +
    createSectionWithAI('ë¬´ë‚œ', 'safe', safe) +
    createSectionWithAI('ê³ ìˆ˜', 'pro', pro);
    
  // ìœ íš¨í•œ ìƒ‰ìƒ ì´ë¦„ì¼ ë•Œë§Œ ë§í¬ ì—…ë°ì´íŠ¸
  updateMusinsaLink('top', COLOR_HEX[topName] ? topName : null);
  updateMusinsaLink('bottom', COLOR_HEX[bottomName] ? bottomName : null);
}


/* ===== ìˆ˜ì •: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (AI í˜¸ì¶œ) ===== */

/**
 * ìƒ‰ìƒ ì¹´ë“œë¥¼ í´ë¦­í–ˆì„ ë•Œ AI ì¶”ì²œ ì‹¤í–‰
 */
function onColorCardClick(name) {
  const mode = current('mode') || 'top2bottom';
  const mood = current('mood');
  const style = current('style');
  const text = $('#textPrompt').value;
  
  sLS(LS.recent, name);
  updateRecent();

  let request = { mood, style, text };
  if (mode === 'top2bottom') {
    request.top = name;
  } else {
    request.bottom = name;
  }

  getAndRenderAIRecommendation(request);
}

/**
 * 'AI ì¶”ì²œ ë°›ê¸°' ë²„íŠ¼ í´ë¦­ ì‹œ (ìˆ˜ì •ë¨)
 */
function onAIButtonClick() {
  const mode = current('mode') || 'top2bottom';
  const mood = current('mood');
  const style = current('style');
  const text = $('#textPrompt').value.trim();

  if (!text) {
    alert("AIì—ê²Œ ìš”ì²­í•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: ì²­ë°”ì§€ ì½”ë””)");
    return;
  }
  
  let request = { mood, style, text };
  
  // (í•µì‹¬ ìˆ˜ì •)
  // í…ìŠ¤íŠ¸ë¥¼ ì•Œë ¤ì§„ ìƒ‰ìƒ/ì•„ì´í…œìœ¼ë¡œ ë¨¼ì € ë§¤í•‘ ì‹œë„
  let baseItem = null;
  if (text.includes("ì²­ë°”ì§€") || text.includes("ë°ë‹˜")) {
    baseItem = "ì¤‘ì²­ ë°ë‹˜";
  } else if (text.includes("í° ì…”ì¸ ") || text.includes("í™”ì´íŠ¸")) {
    baseItem = "í™”ì´íŠ¸";
  } else if (text.includes("ê²€ì • ìŠ¬ë™ìŠ¤") || text.includes("ë¸”ë™")) {
    baseItem = "ë¸”ë™";
  }
  // ...

  if (baseItem) { // ë§¤í•‘ ì„±ê³µ (ì•„ì´í…œ/ìƒ‰ìƒ ìš”ì²­)
    if (mode === 'bottom2top') {
      request.bottom = baseItem;
      $('#resultTitle').textContent = 'AI ì¶”ì²œ (ìƒì˜)';
    } else {
      request.top = baseItem;
      $('#resultTitle').textContent = 'AI ì¶”ì²œ (í•˜ì˜)';
    }
    sLS(LS.recent, baseItem);
  } else { // ë§¤í•‘ ì‹¤íŒ¨ (ìƒí™© ìš”ì²­. ì˜ˆ: "ë°ì´íŠ¸ë£©")
    // request.top, request.bottomì„ ì„¤ì •í•˜ì§€ *ì•ŠìŒ*
    // AIê°€ textë§Œ ë³´ê³  í˜ì–´ë¥¼ ì œì•ˆí•´ì•¼ í•¨
    // (ëª¨ë“œì— ë”°ë¼ ì¶”ì²œ ëŒ€ìƒì´ ë°”ë€” ìˆ˜ ìˆìŒ - í˜„ì¬ëŠ” í•˜ì˜ ì¶”ì²œìœ¼ë¡œ í†µì¼)
    $('#resultTitle').textContent = 'AI ì¶”ì²œ (ìƒí™© ê¸°ë°˜)';
    sLS(LS.recent, text); // "ë°ì´íŠ¸ë£©"ì„ ì €ì¥
  }
  
  updateRecent();
  getAndRenderAIRecommendation(request);
}


function updateRecent() { 
  const r = gLS(LS.recent, null); 
  $('#recentHint').textContent = 'ìµœê·¼ ì„ íƒ: ' + (r || '-'); 
}

/* ì´ˆê¸°í™”/ì´ë²¤íŠ¸ */
document.addEventListener('DOMContentLoaded', () => {
  buildChips(); updateModeTitles(); renderPalette(); updateRecent();
  
  $('#aiBtn').addEventListener('click', onAIButtonClick);

  // ì¶”ì²œ ì¹© í´ë¦­ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ (ìˆ˜ì •ë¨)
  $('#resultArea').addEventListener('click', (e) => {
    const chip = e.target.closest('.chip-reco'); if (!chip) return;
    const colorName = chip.dataset.color; if (!colorName) return;

    // (ìˆ˜ì •) ì¶”ì²œ ì œëª©(Title)ì„ ê¸°ì¤€ìœ¼ë¡œ ìƒì˜/í•˜ì˜ ì—…ë°ì´íŠ¸ ì—¬ë¶€ ê²°ì •
    const title = $('#resultTitle').textContent;
    
    if (title.includes('ìƒì˜')) { 
      // 'AI ì¶”ì²œ (ìƒì˜)' -> ì¹©ì€ ìƒì˜ì„
      const pt = document.getElementById('previewTop');
      if (pt) pt.style.backgroundColor = COLOR_HEX[colorName] || '#555';
      const tcn = document.getElementById('topColorName');
      if (tcn) tcn.textContent = colorName;
      updateMusinsaLink('top', colorName);
    } else { 
      // 'AI ì¶”ì²œ (í•˜ì˜)' ë˜ëŠ” 'AI ì¶”ì²œ (ìƒí™© ê¸°ë°˜)' -> ì¹©ì€ í•˜ì˜ì„
      const pb = document.getElementById('previewBottom');
      if (pb) pb.style.backgroundColor = COLOR_HEX[colorName] || '#555';
      const bcn = document.getElementById('bottomColorName');
      if (bcn) bcn.textContent = colorName;
      updateMusinsaLink('bottom', colorName);
    }
  });


  // chip interactions
  document.body.addEventListener('click', (e)=>{
    const c = e.target.closest('.chip'); if(!c) return;
    const group = c.dataset.group; if(!group) return;
    const id = c.dataset.id; 
    if (group === 'mood' || group === 'style' || group === 'mode') {
      activateChip(group, id); 
      updateHints();
    }
  });

  // reset
  $('#resetBtn').addEventListener('click', ()=>{
    localStorage.clear(); buildChips(); updateModeTitles(); renderPalette();
    $('#resultArea').innerHTML = '<p style="color:#93a0ba">ğŸ’¡ ìƒ‰ ì¹´ë“œë¥¼ í´ë¦­í•˜ê±°ë‚˜ AIì— ìš”ì²­í•˜ë©´ ì¶”ì²œì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>';
    $('#textPrompt').value = '';
    updateRecent();
  });

  // UX modal
  const modal = $('#uxModal');
  $('#uxBtn').addEventListener('click', ()=>{ modal.style.display='flex';});
  $('#uxClose').addEventListener('click', ()=>{ modal.style.display='none';});
  modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.style.display='none'; });
});
</script>
</body>
</html>
